<ng-template #orgDropdown>
  <newbee-dropdown
    *ngIf="selectedOrganization && isAdmin"
    placement="bottom-start"
  >
    <button
      label
      type="button"
      class="btn btn-ghost flex flex-row flex-nowrap gap-x-1"
    >
      <span class="truncate">{{ selectedOrganization!.name }}</span>

      <!-- chevron-down svg -->
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-4 h-4"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M19.5 8.25l-7.5 7.5-7.5-7.5"
        />
      </svg>
    </button>

    <ul dropdown class="menu flex flex-col flex-nowrap w-44">
      <li>
        <a
          (click)="
            emitNavigateToLink(
              shortUrl.Organization,
              selectedOrganization.slug,
              keyword.Edit
            )
          "
          class="flex"
          >Edit org</a
        >
      </li>
      <li>
        <a
          (click)="
            emitNavigateToLink(
              shortUrl.Organization,
              selectedOrganization.slug,
              keyword.Invite
            )
          "
          class="flex"
          >Invite members</a
        >
      </li>
    </ul>
  </newbee-dropdown>

  <p
    *ngIf="selectedOrganization && !isAdmin"
    class="uppercase font-semibold text-sm mx-4"
  >
    {{ selectedOrganization.name }}
  </p>
</ng-template>

<div class="drawer">
  <input type="checkbox" id="navbar-drawer" class="drawer-toggle" />

  <div class="drawer-content">
    <div class="flex flex-row">
      <div class="flex-none hidden md:block">
        <newbee-authenticated-sidebar
          [organizations]="organizations"
          [selectedOrganization]="selectedOrganization"
          (selectedOrganizationChange)="selectOrganization($event)"
          (navigateToLink)="navigateToLink.emit($event)"
        ></newbee-authenticated-sidebar>
      </div>

      <div class="w-full h-screen overflow-y-auto">
        <div class="navbar w-full">
          <div class="navbar-start">
            <label
              for="navbar-drawer"
              class="btn btn-ghost drawer-button md:hidden"
            >
              <!-- bars-3 svg -->
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-6 h-6"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
                />
              </svg>
            </label>

            <newbee-tooltip text="Home" placement="bottom">
              <button
                type="button"
                *ngIf="selectedOrganization && pastOrgHome"
                (click)="
                  emitNavigateToLink(
                    shortUrl.Organization,
                    selectedOrganization.slug
                  )
                "
                class="btn btn-ghost"
              >
                <!-- home svg -->
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                  class="w-6 h-6"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"
                  />
                </svg>
              </button>
            </newbee-tooltip>

            <div class="hidden md:block">
              <ng-container *ngTemplateOutlet="orgDropdown"></ng-container>
            </div>
          </div>

          <div
            *ngIf="initialSearchTerm && selectedOrganization"
            class="navbar-center hidden md:block"
          >
            <form
              [formGroup]="searchTerm"
              (ngSubmit)="emitSearch()"
              class="flex flex-row gap-x-2"
            >
              <newbee-searchbar
                formControlName="searchbar"
                [suggestions]="searchSuggestions"
                (selectSuggestion)="selectSuggestion($event)"
              ></newbee-searchbar>
            </form>
          </div>

          <div class="navbar-end">
            <div class="block md:hidden">
              <ng-container *ngTemplateOutlet="orgDropdown"></ng-container>
            </div>

            <div class="hidden md:flex">
              <newbee-dropdown
                *ngIf="selectedOrganization"
                placement="bottom-end"
              >
                <newbee-tooltip label text="Create" placement="bottom">
                  <button type="button" class="btn btn-ghost">
                    <!-- document-plus svg -->
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke-width="1.5"
                      stroke="currentColor"
                      class="w-6 h-6"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"
                      />
                    </svg>
                  </button>
                </newbee-tooltip>

                <ul dropdown class="menu flex flex-col flex-nowrap w-44">
                  <li>
                    <a
                      (click)="
                        emitNavigateToLink(
                          shortUrl.Organization,
                          selectedOrganization!.slug,
                          shortUrl.Doc,
                          keyword.New
                        )
                      "
                      class="flex"
                      >Create doc</a
                    >
                  </li>
                  <li>
                    <a
                      (click)="
                        emitNavigateToLink(
                          shortUrl.Organization,
                          selectedOrganization!.slug,
                          shortUrl.Qna,
                          keyword.New
                        )
                      "
                      class="flex"
                      >Create qna</a
                    >
                  </li>
                  <li *ngIf="isAdmin">
                    <a
                      (click)="
                        emitNavigateToLink(
                          shortUrl.Organization,
                          selectedOrganization!.slug,
                          shortUrl.Team,
                          keyword.New
                        )
                      "
                      class="flex"
                      >Create team</a
                    >
                  </li>
                </ul>
              </newbee-dropdown>

              <newbee-dropdown placement="bottom-end">
                <newbee-tooltip label text="Account" placement="bottom">
                  <button type="button" class="btn btn-ghost">
                    {{ user.displayName ?? user.name }}
                  </button>
                </newbee-tooltip>

                <ul dropdown class="menu flex flex-col flex-nowrap w-44">
                  <li>
                    <a (click)="emitNavigateToLink(keyword.User)" class="flex"
                      >Manage your account</a
                    >
                  </li>
                  <li><a (click)="emitLogout()" class="flex">Log out</a></li>
                </ul>
              </newbee-dropdown>
            </div>
          </div>
        </div>

        <div class="px-4 py-2 mt-6">
          <ng-content></ng-content>
        </div>
      </div>
    </div>
  </div>

  <div class="drawer-side">
    <label for="navbar-drawer" class="drawer-overlay"></label>
    <div class="flex flex-row w-3/4 sm:w-1/2">
      <div class="flex-none">
        <newbee-authenticated-sidebar
          [organizations]="organizations"
          [selectedOrganization]="selectedOrganization"
          (selectedOrganizationChange)="selectOrganization($event)"
          (navigateToLink)="navigateToLink.emit($event)"
        ></newbee-authenticated-sidebar>
      </div>
      <div
        class="flex flex-col flex-nowrap p-4 h-screen bg-base-200 w-full overflow-y-auto"
      >
        <div
          *ngIf="selectedOrganization && isAdmin"
          class="collapse collapse-arrow"
        >
          <input type="checkbox" id="org-collapse" />
          <label for="org-collapse" class="collapse-title">{{
            selectedOrganization.name
          }}</label>
          <div class="collapse-content flex flex-col gap-y-2 flex-nowrap">
            <a
              (click)="
                emitNavigateToLink(
                  shortUrl.Organization,
                  selectedOrganization.slug,
                  keyword.Edit
                )
              "
              class="link link-hover"
              >Edit org</a
            >
            <a
              (click)="
                emitNavigateToLink(
                  shortUrl.Organization,
                  selectedOrganization.slug,
                  keyword.Invite
                )
              "
              class="link link-hover"
              >Invite members</a
            >
          </div>
        </div>

        <div *ngIf="selectedOrganization" class="collapse collapse-arrow">
          <input type="checkbox" id="create-collapse" />
          <label for="create-collapse" class="collapse-title">Create</label>
          <div class="collapse-content flex flex-col flex-nowrap gap-y-2">
            <a
              (click)="
                emitNavigateToLink(
                  shortUrl.Organization,
                  selectedOrganization!.slug,
                  shortUrl.Doc,
                  keyword.New
                )
              "
              class="link link-hover"
              >Create doc</a
            >
            <a
              (click)="
                emitNavigateToLink(
                  shortUrl.Organization,
                  selectedOrganization!.slug,
                  shortUrl.Qna,
                  keyword.New
                )
              "
              class="link link-hover"
              >Create question</a
            >
            <a
              *ngIf="isAdmin"
              (click)="
                emitNavigateToLink(
                  shortUrl.Organization,
                  selectedOrganization!.slug,
                  shortUrl.Team,
                  keyword.New
                )
              "
              class="link link-hover"
              >Create team</a
            >
          </div>
        </div>

        <div class="collapse collapse-arrow">
          <input type="checkbox" id="account-collapse" />
          <label for="account-collapse" class="collapse-title">Account</label>
          <div class="collapse-content flex flex-col flex-nowrap gap-y-2">
            <a
              (click)="emitNavigateToLink(keyword.User)"
              class="link link-hover"
              >Manage your account</a
            >
            <a (click)="emitLogout()" class="link link-hover">Log out</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
